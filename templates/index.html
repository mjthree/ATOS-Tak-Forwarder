<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marshall TAK Forwarder</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #f5f5f5; 
            margin: 0; 
            padding: 0; 
        }
        .header { 
            background: #2c3e50; 
            color: white; 
            padding: 20px; 
            border-radius: 10px; 
            margin: 20px; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .tag-table { 
            width: 100%; 
            border-collapse: collapse; 
            background: white; 
            border-radius: 8px; 
            overflow: hidden; 
        }
        .tag-table th, .tag-table td { 
            padding: 10px; 
            text-align: left; 
            border-bottom: 1px solid #eee; 
        }
        .tag-table th { 
            background: #34495e; 
            color: white; 
        }
        .tag-table tr:last-child td { 
            border-bottom: none; 
        }
        .stale-row { 
            opacity: 0.5; 
            background: #f8f9fa !important;
        }
        .status-active {
            color: #28a745;
            font-weight: 600;
        }
        .status-stale {
            color: #dc3545;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸš€ Marshall TAK Forwarder</h1>
        <p>Real-time tag monitoring and TAK forwarding</p>
    </div>
    <div class="container">
        <table class="tag-table">
            <thead>
                <tr>
                    <th>Tag</th>
                    <th>Status</th>
                    <th>Lat</th>
                    <th>Lon</th>
                    <th>Alt (ft)</th>
                    <th>Battery</th>
                    <th>Last Update</th>
                </tr>
            </thead>
            <tbody id="tag-table-body">
                <!-- Tag rows will be populated here -->
            </tbody>
        </table>
    </div>
    <script>
        function fetchTags() {
            fetch('/api/data').then(r => r.json()).then(data => {
                const tbody = document.getElementById('tag-table-body');
                tbody.innerHTML = '';
                
                if (Object.keys(data.tags).length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #666;">No tag data available</td></tr>';
                    return;
                }
                
                Object.entries(data.tags).forEach(([tag_id, tag]) => {
                    const tr = document.createElement('tr');
                    const isStale = tag.stale;
                    
                    if (isStale) {
                        tr.classList.add('stale-row');
                    }
                    
                    tr.innerHTML = `
                        <td><strong>${tag_id}</strong></td>
                        <td class="${isStale ? 'status-stale' : 'status-active'}">
                            ${isStale ? 'Stale' : 'Active'}
                        </td>
                        <td>${tag.latitude !== undefined ? tag.latitude.toFixed(6) : 'N/A'}</td>
                        <td>${tag.longitude !== undefined ? tag.longitude.toFixed(6) : 'N/A'}</td>
                        <td>${tag.altitude_ft !== undefined ? tag.altitude_ft.toFixed(1) : 'N/A'}</td>
                        <td>${tag.battery_voltage !== undefined ? tag.battery_voltage.toFixed(2) + 'V' : 'N/A'}</td>
                        <td>${tag.timestamp || 'N/A'}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }).catch(error => {
                console.error('Error fetching tags:', error);
                document.getElementById('tag-table-body').innerHTML = 
                    '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #dc3545;">Error loading data</td></tr>';
            });
        }
        
        // Initialize
        fetchTags();
        setInterval(fetchTags, 2000);
    </script>
</body>
</html>
